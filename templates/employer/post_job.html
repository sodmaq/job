{%include 'employer/header.html'%}
    

    <!-- Page Content -->
    <div class="content job-management-page mt-5">
        <div class="container">
            <!-- Page Header -->
            <div class="d-flex justify-content-between align-items-center">
                <h1 class="text-primary">Job Management</h1>
                <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#postJobModal">
                    <i class="fas fa-plus me-2"></i> Post a Job
                </button>
            </div>
    
            <p class="lead mb-5">Manage your job postings, edit, or delete as needed. Ensure your job listings are up to date to attract the best candidates.</p>
    
            <!-- Job Management Table -->
            <div class="table-responsive">
                <table class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Job Title</th>
                            <th>Department</th>
                            <th>Location</th>
                            <th>Experience Level</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for job in jobs %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ job.get('title', 'N/A') }}</td>  <!-- Safe handling if title doesn't exist -->
                            <td>{{ job.get('department', 'N/A') }}</td>  <!-- Safe handling if department is missing -->
                            <td>{{ job.get('location', 'N/A') }}</td>  <!-- Same for location -->
                            <td>{{ job.get('experience', 'N/A') }}</td>  <!-- Same for experience -->
                            <td>
                                <button class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#editJobModal"
                                    data-job-id="{{ job.id }}"
                                    data-job-title="{{ job.title }}"
                                    data-job-company="{{ job.company }}"
                                    data-department="{{ job.department }}"
                                    data-location="{{ job.location }}"
                                    data-experience="{{ job.experience }}"
                                    data-job-type="{{ job.job_type }}"
                                    data-salary="{{ job.salary }}"
                                    data-description="{{ job.description }}"
                                    data-skills="{{ job.skills }}">
                                    Edit
                                </button>

                                <button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteJobModal"
                                    data-job-id="{{ job.get('id') }}">
                                    Delete
                                </button>
                            
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="6" class="text-center text-muted">No job listings found.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    
                    
                </table>
                
            </div>
        </div>
    
        <!-- Post Job Modal -->
        <div class="modal fade" id="postJobModal" tabindex="-1" aria-labelledby="postJobModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="postJobModalLabel">Post a New Job</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <!-- Job Posting Form inside Modal -->
                        <form method="POST" action="{{ url_for('employer_post_job') }}">
                            <div class="mb-3">
                                <label for="company" class="form-label">Company</label>
                                <input type="text" class="form-control" name="company" id="company" placeholder="e.g. TechNova" required>
                            </div>
                            <div class="mb-3">
                                <label for="jobTitle" class="form-label">Job Title</label>
                                <input type="text" class="form-control" name="title" id="jobTitle" placeholder="e.g. Frontend Developer" required>
                            </div>
    
                            <div class="mb-3">
                                <label for="department" class="form-label">Department</label>
                                <input type="text" class="form-control" name="department" id="department" placeholder="e.g. IT" required>
                            </div>
    
                            <div class="mb-3">
                                <label for="jobType" class="form-label">Job Type</label>
                                <select class="form-select" id="jobType" name="job_type" required>
                                    <option selected>Full-Time</option>
                                    <option>Part-Time</option>
                                    <option>Contract</option>
                                    <option>Internship</option>
                                </select>
                            </div>
    
                            <div class="mb-3">
                                <label for="experienceLevel" class="form-label">Experience Level</label>
                                <select class="form-select" id="experienceLevel" name="experience" required>
                                    <option selected>Junior</option>
                                    <option>Mid-Level</option>
                                    <option>Senior</option>
                                </select>
                            </div>
    
                            <div class="mb-3">
                                <label for="salary" class="form-label">Salary Range</label>
                                <input type="text" class="form-control" id="salary" name="salary" placeholder="e.g. $60,000 - $75,000" required>
                            </div>
    
                            <div class="mb-3">
                                <label for="location" class="form-label">Job Location</label>
                                <input type="text" class="form-control" id="location" name="location" placeholder="e.g. Remote or New York" required>
                            </div>
    
                            <div class="mb-3">
                                <label for="jobDescription" class="form-label">Job Description</label>
                                <textarea class="form-control" id="jobDescription" rows="4" name="description" placeholder="Write a detailed job description here..." required></textarea>
                            </div>
    
                            <div class="mb-3">
                                <label for="skills" class="form-label">Required Skills</label>
                                <input type="text" class="form-control" id="skills" name="skills" placeholder="e.g. React, JavaScript, HTML, CSS" required>
                            </div>
    
                            <div class="text-center">
                                <button type="submit" class="btn btn-success">Post Job</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    
        <!-- Edit Job Modal -->
        <div class="modal fade" id="editJobModal" tabindex="-1" aria-labelledby="editJobModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editJobModalLabel">Edit Job Details</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <!-- Edit Job Form inside Modal -->
                        <form method="POST" id="editJobForm">
                            <input type="hidden" name="job_id" id="editJobId">
                            
                            <div class="mb-3">
                                <label for="editJobTitle">Job Title</label>
                                <input type="text" class="form-control" id="editJobTitle" name="title" required>
                            </div>
                            
                            <div class="mb-3">
                                <label for="editJobTitle">Job company</label>
                                <input type="text" class="form-control" id="editJobCompany" name="company" required>
                            </div>
                        
                            <div class="mb-3">
                                <label for="editDepartment">Department</label>
                                <input type="text" class="form-control" id="editDepartment" name="department" required>
                            </div>
                        
                            <div class="mb-3">
                                <label for="editJobType">Job Type</label>
                                <select class="form-select" id="editJobType" name="job_type" required>
                                    <option>Full-Time</option>
                                    <option>Part-Time</option>
                                    <option>Contract</option>
                                    <option>Internship</option>
                                </select>
                            </div>
                        
                            <div class="mb-3">
                                <label for="editExperienceLevel">Experience Level</label>
                                <select class="form-select" id="editExperienceLevel" name="experience" required>
                                    <option>Junior</option>
                                    <option>Mid-Level</option>
                                    <option>Senior</option>
                                </select>
                            </div>
                        
                            <div class="mb-3">
                                <label for="editSalary">Salary Range</label>
                                <input type="text" class="form-control" id="editSalary" name="salary" required>
                            </div>
                        
                            <div class="mb-3">
                                <label for="editLocation">Location</label>
                                <input type="text" class="form-control" id="editLocation" name="location" required>
                            </div>
                        
                            <div class="mb-3">
                                <label for="editJobDescription">Description</label>
                                <textarea class="form-control" id="editJobDescription" name="description" rows="4" required></textarea>
                            </div>
                        
                            <div class="mb-3">
                                <label for="editSkills">Skills</label>
                                <input type="text" class="form-control" id="editSkills" name="skills" required>
                            </div>
                        
                            <div class="text-center">
                                <button type="submit" class="btn btn-primary">Save Changes</button>
                            </div>
                        </form>
                        
                    </div>
                </div>
            </div>
        </div>

    
        <!-- Delete Job Modal -->
        <div class="modal fade" id="deleteJobModal" tabindex="-1" aria-labelledby="deleteJobModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-company" id="deleteJobModalLabel">Confirm Deletion</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure you want to delete this job posting?</p>
                        <p><strong>This action cannot be undone.</strong></p>
                    </div>
                    <div class="modal-footer">
                        <form method="POST" id="deleteJobForm">
                            <input type="hidden" name="job_id" id="deleteJobId">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-danger">Delete</button>
                        </form>                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <script>
            {% for category, message in messages %}
            Swal.fire({
                title: "{{ message }}",
                icon: "{{ 'success' if category == 'success' else 'error' }}",
                confirmButtonColor: '#329F82'
            });
            {% endfor %}
        </script>
        {% endif %}
    {% endwith %}
  
    
    <script>
        const editModal = document.getElementById('editJobModal');
        editModal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget;
    
            // Set all form values
            document.getElementById('editJobId').value = button.getAttribute('data-job-id');
            document.getElementById('editJobTitle').value = button.getAttribute('data-job-title');
            document.getElementById('editJobCompany').value = button.getAttribute('data-job-company');
            document.getElementById('editDepartment').value = button.getAttribute('data-department');
            document.getElementById('editJobType').value = button.getAttribute('data-job-type');
            document.getElementById('editExperienceLevel').value = button.getAttribute('data-experience');
            document.getElementById('editSalary').value = button.getAttribute('data-salary');
            document.getElementById('editLocation').value = button.getAttribute('data-location');
            document.getElementById('editJobDescription').value = button.getAttribute('data-description');
            document.getElementById('editSkills').value = button.getAttribute('data-skills');
    
            // Optional: Update form action if needed
            const jobId = button.getAttribute('data-job-id');
            document.getElementById('editJobForm').action = `/employer/edit-job/${jobId}`;
        });
    </script>
    <script>
        const deleteModal = document.getElementById('deleteJobModal');
        deleteModal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget;
            const jobId = button.getAttribute('data-job-id');
    
            const form = document.getElementById('deleteJobForm');
            document.getElementById('deleteJobId').value = jobId;
            form.action = `/employer/delete-job/${jobId}`;
        });
    </script>
    
    
    
    
    
    {%include 'employer/footer.html'%}
