{% include 'user/header.html'%}

    

    <!-- Page Content -->
    <div class="content saved-jobs-page mt-5">
        <div class="container">
            <h1 class="my-4 text-center text-primary">Saved Jobs</h1>
            <p class="lead text-center mb-5">Here are the jobs you've saved. You can apply, remove, or view the details of each job.</p>

            {% if saved_jobs %}
            <div class="table-responsive">
                <table class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>Job Title</th>
                            <th>Company</th>
                            <th>Location</th>
                            <th>Match Score</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for job in saved_jobs %}
                        <tr>
                            <td><a href="{{ url_for('user_job_details', job_id=job.job_id) }}">{{ job.title }}</a></td>
                            <td>{{ job.company }}</td>
                            <td>{{ job.location }}</td>
                            <td>{{ job.match_score }}%</td>
                            <td>
                                <form method="POST" action="{{ url_for('remove_saved_job', job_id=job.job_id) }}" style="display:inline;">
                                    <button class="btn btn-danger btn-sm" type="submit">Remove</button>
                                </form>
                                <button class="btn btn_button btn-sm applyJobBtn" data-job-id="{{ job.job_id }}">Apply</button>

                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="no-saved-jobs text-center mt-5">
                <h4>No jobs saved yet.</h4>
                <p>You can save jobs to view them here later.</p>
            </div>
            {% endif %}
        </div>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <script>
        {% for category, message in messages %}
        Swal.fire({
            icon: '{{ category }}',  // 'success', 'error', etc.
            title: '{{ "Success" if category == "success" else "Oops!" }}',
            text: '{{ message }}',
            confirmButtonColor: '#3085d6'
        });
        {% endfor %}
    </script>
    {% endif %}
    {% endwith %}


    <script>
      document.querySelectorAll('.applyJobBtn').forEach(button => {
        button.addEventListener('click', function() {
            const jobId = this.getAttribute('data-job-id');
            
            // Check if jobId is defined
            if (!jobId) {
                alert("Job ID is missing.");
                return;
            }

            fetch('/user/apply_job', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ job_id: jobId })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    // Show success message
                    Swal.fire({
                        title: 'Success!',
                        text: data.message,
                        icon: 'success',
                        confirmButtonText: 'Okay'
                    });
                } else {
                    // Show error message
                    Swal.fire({
                        title: 'Error!',
                        text: data.message,
                        icon: 'error',
                        confirmButtonText: 'Okay'
                    });
                }
            })
            .catch(err => {
                console.error(err);
                Swal.fire({
                    title: 'Error!',
                    text: 'An error occurred while applying for the job.',
                    icon: 'error',
                    confirmButtonText: 'Okay'
                });
            });
        });
    });

    </script>



    

    {% include 'user/footer.html'%}
